%% Architecture for Customer Insights & Loan Process Optimization
flowchart LR

%% INGESTION LAYER
subgraph Ingestion
    A1[ğŸ¦ Branch / Portal Upload<br/>Web/Mobile App, Internal LOS]
    A2[ğŸ’¾ ADLS Gen2 / Blob Storage<br/>Landing Zone - Raw Files]
    A3[ğŸ” Event Grid Trigger<br/>(Async downstream processing)]
    A1 --> A2
    A2 --> A3
end

%% DOCUMENT AI LAYER
subgraph Document_AI[ğŸ“„ Document AI - OCR & Extraction]
    B1[Azure Form Recognizer<br/>(Prebuilt + Custom Models)]
    B2[Extracted JSON + Confidence Scores]
    B1 --> B2
end

A3 --> B1

%% PROCESSING & VALIDATION
subgraph Processing[ğŸ”„ Data Processing & Validation]
    C1[Azure Data Factory / Databricks ETL]
    C2[Data Quality Rules & Business Validation]
    C3[Schema Mapping to Canonical Model]
    C1 --> C2 --> C3
end

B2 --> C1

%% STORAGE LAYER
subgraph Storage[ğŸ—„ Central Data Lake + Warehouse]
    D1[(Raw Zone)]
    D2[(Processed Zone)]
    D3[(Curated / Gold Zone<br/>Synapse SQL / Delta Tables)]
    C3 --> D1
    C3 --> D2
    D2 --> D3
end

%% ANALYTICS & INSIGHTS
subgraph ML[ğŸ¤– ML Platform]
    E1[Feature Store<br/>Customer 360 Features]
    E2[Churn Prediction Model]
    E3[Next Best Offer Model]
    E4[Loan Risk Support Model]
    E5[Model Monitoring<br/>AUC, Drift, Explainability]
    D3 --> E1
    E1 --> E2
    E1 --> E3
    E1 --> E4
    E2 --> E5
    E3 --> E5
    E4 --> E5
end

%% CONSUMPTION LAYER
subgraph Serving[ğŸ“Š Serving & Consumption]
    F1[Underwriter UI<br/>Low-Latency API]
    F2[CRM / Campaign Systems]
    F3[Power BI Dashboards<br/>Executive KPIs]
end

E2 --> F1
E3 --> F2
E4 --> F1
D3 --> F3

%% SECURITY & GOVERNANCE
subgraph Security[ğŸ” Governance]
    G1[RBAC + PIM + AAD]
    G2[Audit Logs + Lineage]
    G3[PII Encryption at Rest & Transit]
end

Storage -.-> Security
ML -.-> Security
Serving -.-> Security
